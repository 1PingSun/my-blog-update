<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>微調小型語言模型（SLM）製作輔導諮商語音聊天機器人</title><meta name="description" content="孫逸平的個人部落格，分享資訊安全、創客專案、程式設計與技術心得。臺北市數位實驗高中學生，專精於網路安全、CTF競賽和技術開發。"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics 4 --><script async src="https://www.googletagmanager.com/gtag/js?id=G-DPPW3TCM0K"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-DPPW3TCM0K');</script><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="簡介隨著人工智慧技術的發展，加上 Apple 對開源社群的投資，想要在自己的 Mac 電腦上運行語言模型已不再是什麼困難的事情。
於是我就開始思考，語言模型除了製作類似 ChatGPT 的聊天機器人，是否還能運用在其他領域。眾所周知，心理諮商的成本相當之高，一小時的諮商可能就要花掉上千元，然而在諮商時，往往需要耗費大把的時間在搜集病人的基本資訊及背景，若能透過語言模型製作輔導諮商的聊天機器人將可降低大量時間與金錢成本。
心理諮商師的語氣和說話模式是諮商時的關鍵重點之一，而模型微調即是相當適合改變語言模型說話模式的途徑。
因此我想使用心理諮商的對話紀錄資料集微調小型語言模型並進行語音的訓練，製作輔導諮商語音聊天機器人，以協助心理諮商領域降低諮商成本。
然而本次製作僅為測試階段及示範，並無實際拿相關資料進行訓練.."><meta name="keywords" content="SLM, 小型語言模型, 模型微調, fine-tuning, 聊天機器人, 輔導諮商, AI, 人工智慧, 心理諮商, post, blog, 1Ping, 孫逸平"><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="1Ping's Blog" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">1Ping's Blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">微調小型語言模型（SLM）製作輔導諮商語音聊天機器人</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B0%A1%E4%BB%8B"><span class="toc-text">簡介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%BD%E4%BD%9C%E8%A6%8F%E5%8A%83%E8%88%87%E6%9E%B6%E6%A7%8B"><span class="toc-text">製作規劃與架構</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-1%EF%BC%9A%E7%92%B0%E5%A2%83%E5%BB%BA%E7%BD%AE"><span class="toc-text">Step 1：環境建置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-2-%E4%B8%8B%E8%BC%89%E6%A8%A1%E5%9E%8B"><span class="toc-text">Step 2: 下載模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-3%EF%BC%9A%E9%80%B2%E8%A1%8C%E5%BE%AE%E8%AA%BF"><span class="toc-text">Step 3：進行微調</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-4-%E8%AA%9E%E9%9F%B3%E7%94%9F%E6%88%90"><span class="toc-text">Step 4: 語音生成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B8%BD%E7%B5%90"><span class="toc-text">總結</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Project"><i class="tag post-item-tag">Project</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">微調小型語言模型（SLM）製作輔導諮商語音聊天機器人</h1><time class="has-text-grey" datetime="2024-09-17T16:00:00.000Z">2024-09-18</time><article class="mt-2 post-content"><h2 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h2><p>隨著人工智慧技術的發展，加上 Apple 對開源社群的投資，想要在自己的 Mac 電腦上運行語言模型已不再是什麼困難的事情。</p>
<p>於是我就開始思考，語言模型除了製作類似 ChatGPT 的聊天機器人，是否還能運用在其他領域。眾所周知，心理諮商的成本相當之高，一小時的諮商可能就要花掉上千元，然而在諮商時，往往需要耗費大把的時間在搜集病人的基本資訊及背景，若能透過語言模型製作輔導諮商的聊天機器人將可降低大量時間與金錢成本。</p>
<p>心理諮商師的語氣和說話模式是諮商時的關鍵重點之一，而模型微調即是相當適合改變語言模型說話模式的途徑。</p>
<p>因此我想使用心理諮商的對話紀錄資料集微調小型語言模型並進行語音的訓練，製作輔導諮商語音聊天機器人，以協助心理諮商領域降低諮商成本。</p>
<p>然而本次製作僅為測試階段及示範，並無實際拿相關資料進行訓練。</p>
<h2 id="製作規劃與架構"><a href="#製作規劃與架構" class="headerlink" title="製作規劃與架構"></a>製作規劃與架構</h2><ol>
<li><strong>建置環境</strong>：建立 conda 環境並使用 GitHub 上的 <a target="_blank" rel="noopener" href="https://github.com/linyiLYi/bilibot">linyiLYi/bilibot</a> 專案。</li>
<li><strong>下載模型</strong>：下載本次使用的 <a target="_blank" rel="noopener" href="https://huggingface.co/Qwen/Qwen1.5-4B-Chat">Qwen/Qwen1.5-4B-Chat</a> 模型。本次運行的環境如下：<ul>
<li>CPU：Apple M1 Pro</li>
<li>RAM：16 GB</li>
</ul>
</li>
<li><strong>進行微調</strong>：借助 <a target="_blank" rel="noopener" href="https://github.com/ml-explore/mlx-examples/blob/main/llms/mlx_lm/LORA.md">mlx-lm</a> 進行微調。</li>
<li><strong>語音生成</strong>：透過 <a target="_blank" rel="noopener" href="https://github.com/RVC-Boss/GPT-SoVITS">GPT-SoVITS</a> 將語言模型的問答進行生成語音。</li>
</ol>
<hr>
<h2 id="Step-1：環境建置"><a href="#Step-1：環境建置" class="headerlink" title="Step 1：環境建置"></a>Step 1：環境建置</h2><blockquote>
<ol>
<li>克隆 <a target="_blank" rel="noopener" href="https://github.com/linyiLYi/bilibot">linyiLYi/bilibot</a> 的專案：</li>
</ol>
</blockquote>
<pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/linyiLYi/bilibot.git</code></pre>
<blockquote>
<ol start="2">
<li>執行以下指令確認 Anaconda 是否安裝，若沒有成功顯示版本號，請至<a target="_blank" rel="noopener" href="https://www.anaconda.com/download/success">官網</a>下載並安裝 Anaconda。</li>
</ol>
</blockquote>
<pre><code class="hljs bash">conda --version</code></pre>

<blockquote>
<ol start="3">
<li>建立環境並啟動：</li>
</ol>
</blockquote>
<pre><code class="hljs bash">conda create -n bilibot python=3.10
conda activate bilibot</code></pre>
<blockquote>
<ol start="4">
<li>進入 bilibot 資料夾中並安裝套件：</li>
</ol>
</blockquote>
<pre><code class="hljs bash"><span class="hljs-built_in">cd</span> bilibot
pip install -r requirements.txt</code></pre>

<h2 id="Step-2-下載模型"><a href="#Step-2-下載模型" class="headerlink" title="Step 2: 下載模型"></a>Step 2: 下載模型</h2><blockquote>
<ol>
<li>透過 brew 安裝 git-lfs，或在<a target="_blank" rel="noopener" href="https://git-lfs.com/">官網</a>查看其他安裝方式：</li>
</ol>
</blockquote>
<pre><code class="hljs bash">git lfs install</code></pre>
<blockquote>
<ol start="2">
<li>在 <code>bilibot/</code> 中建立資料夾 <code>models</code>：</li>
</ol>
</blockquote>
<pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> models</code></pre>
<blockquote>
<ol start="3">
<li>進入 <code>models</code> 資料夾並下載模型，本次使用 Qwen1.5-4B-Chat 作為範例：</li>
</ol>
</blockquote>
<pre><code class="hljs bash"><span class="hljs-built_in">cd</span> models
git <span class="hljs-built_in">clone</span> https://huggingface.co/Qwen/Qwen1.5-4B-Chat</code></pre>
<h2 id="Step-3：進行微調"><a href="#Step-3：進行微調" class="headerlink" title="Step 3：進行微調"></a>Step 3：進行微調</h2><blockquote>
<ol>
<li>回到 <code>bilibot/</code> 資料夾</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>輸入以下指令進行微調，當中的 <code>-batcb-size</code> 若電腦能夠負荷，可改為 <code>16</code>：</li>
</ol>
</blockquote>
<pre><code class="hljs bash">python -m mlx_lm.lora --model models/Qwen1.5-4B-Chat --data data/ --train --iters 1000 --batch-size 4 --lora-layers 12</code></pre>
<blockquote>
<ol start="3">
<li>將微調後的 adapters 文件與原模型合併：</li>
</ol>
</blockquote>
<pre><code class="hljs bash">python -m mlx_lm.fuse --model models/Qwen1.5-4B-Chat --save-path models/Qwen1.5-4B-Chat-FT --adapter-path adapters/</code></pre>
<blockquote>
<ol start="4">
<li>對壓縮後的模型進行加速，執行以下指令前，需對 tools/copress_model.py 檔的內容將模型路徑及檔名進行修改：</li>
</ol>
</blockquote>
<pre><code class="hljs bash">python tools/compress_model.py</code></pre>
<blockquote>
<ol start="5">
<li>對話測試，執行以下指令前，需對 main/chat.py 檔的內容將模型路徑及檔名進行修改：</li>
</ol>
</blockquote>
<pre><code class="hljs bash">python chat.py</code></pre>
<blockquote>
<ol start="6">
<li>現在你可以和一個經過微調，讓說話模式變得很像酸民的聊天機器人。</li>
</ol>
</blockquote>
<p><img src="/posts/2024-SLM-tunning/image.png" alt="Screenshot 2024-07-23 at 00.15.18.png"></p>
<h2 id="Step-4-語音生成"><a href="#Step-4-語音生成" class="headerlink" title="Step 4: 語音生成"></a>Step 4: 語音生成</h2><p>透過 <a target="_blank" rel="noopener" href="https://github.com/RVC-Boss/GPT-SoVITS">GPT-SoVITS</a> 生成語音，Mac 使用者可透過官方的<a target="_blank" rel="noopener" href="https://www.yuque.com/baicaigongchang1145haoyuangong/ib3g1e/znoph9dtetg437xb">教學指南</a>操作，指南當中也有教學的<a target="_blank" rel="noopener" href="https://b23.tv/wJWCNWc">影片</a>。</p>
<p>本次以 Apple Silicon 的電腦作為範例，操作步驟如下：</p>
<blockquote>
<ol>
<li>下載並解壓縮資料：<a target="_blank" rel="noopener" href="https://www.icloud.com/iclouddrive/0c4q1AeMClzGC2l-srUdlJE8Q#GPT-SoVITS">https://www.icloud.com/iclouddrive/0c4q1AeMClzGC2l-srUdlJE8Q#GPT-SoVITS</a></li>
<li>進入資料夾後，在終端機輸入：</li>
</ol>
</blockquote>
<pre><code class="hljs bash">bash install\ <span class="hljs-keyword">for</span>\ mac.sh</code></pre>
<blockquote>
<ol start="3">
<li>執行 webUI：</li>
</ol>
</blockquote>
<pre><code class="hljs bash">./go-webui.command</code></pre>
<blockquote>
<ol start="4">
<li>依照 Web 中的 UI 進行語音訓練。</li>
</ol>
</blockquote>
<hr>
<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>透過這次的實作經驗讓我對於人工智慧有更多的認識，也相當期待未來人工智慧的發展及應用會如何幫助社會更加進步與方便。</p>
<p>這次的實作我認為最可惜的地方是，沒有完整做出輔導諮商語音聊天機器人，不過後續若有時間，還是可以將這個聊天機器人完整的做出來，並且去更深入的調查、了解諮商領域。</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2024/11/09/2024-CGGC-writeup/" title="2024 CGGC 心得及 Writeup"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: 2024 CGGC 心得及 Writeup</span></a><a class="button is-default" href="/2024/09/13/2024-EeePC-Kali/" title="我用 2007 年的迷你電腦安裝 Kali Linux"><span class="has-text-weight-semibold">Next: 我用 2007 年的迷你電腦安裝 Kali Linux</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="1PingSun/1PingSun.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/1PingSun"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--><!-- Telegram--><a title="telegram" target="_blank" rel="noopener nofollow" href="//t.me/sunyiping"><i class="fab fa-telegram-plane"></i></a><!-- Signal--></section><p><span>Copyright ©</span><span> 1Ping 2025</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>