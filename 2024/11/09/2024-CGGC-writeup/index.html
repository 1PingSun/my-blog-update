<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>2024 CGGC 心得及 Writeup</title><meta name="description" content="孫逸平的個人部落格，分享資訊安全、創客專案、程式設計與技術心得。臺北市數位實驗高中學生，專精於網路安全、CTF競賽和技術開發。"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics 4 --><script async src="https://www.googletagmanager.com/gtag/js?id=G-DPPW3TCM0K"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-DPPW3TCM0K');</script><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="這次是我第一次和其他人組隊打 CTF，也是第一次那麼認真的打 CTF，先來講一下人事時地物等等的背景資訊好了。
這次我和朋友一共四個人組隊參加比賽，為了增加打題目的效率和互動討論，我們的指導老師陳晉老師將復興高中的圖書館開放給我們以及他的其他學生打題目，並透過安排了兩天一夜的時間讓我們專注比賽（雖然我中途跑去比學科能力競賽所以沒有住宿啦）。
這次的陣容有一些新手，經過競賽後發現每個人都各有所長、各司其職，以下以 A、B、C、D 代稱四位組員，A 和 B 因為有較多的經驗，所以負責專注的打比賽；而 C 相對缺乏經驗，因此 D 在旁邊拉著他，避免拖到團隊後腿（誤）；同時 C 也被賦予了一個相當重要的角色 — — 負責大家的伙食，一到飯點就會聽到 C 開始揪大家叫外送、飲料、豆花。就在我們四位組員巧妙的完美配合下.."><meta name="keywords" content="CTF, CGGC, 資訊安全競賽, writeup, 駭客競賽, 網路安全, cybersecurity, competition, post, blog, 1Ping, 孫逸平"><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="1Ping's Blog" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">1Ping's Blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">2024 CGGC 心得及 Writeup</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Writeup"><span class="toc-text">Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-previewsite"><span class="toc-text">Web: previewsite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-proxy"><span class="toc-text">Web: proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc-Day31-%E6%B0%B4%E8%90%BD%E7%9F%B3%E5%87%BA%EF%BC%81%E7%9C%9F%E7%9B%B8%E5%A4%A7%E7%99%BD%E7%9A%84%E5%8D%81%E4%B8%80%E6%9C%88%E9%A0%90%E5%91%8A%E4%BF%A1%EF%BC%9F"><span class="toc-text">Misc: Day31- 水落石出！真相大白的十一月預告信？</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Cyber"><i class="tag post-item-tag">Cyber</i></a><a href="/tags/Competition"><i class="tag post-item-tag">Competition</i></a><a href="/tags/CTF"><i class="tag post-item-tag">CTF</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">2024 CGGC 心得及 Writeup</h1><time class="has-text-grey" datetime="2024-11-09T16:00:00.000Z">2024-11-10</time><article class="mt-2 post-content"><p>這次是我第一次和其他人組隊打 CTF，也是第一次那麼認真的打 CTF，先來講一下人事時地物等等的背景資訊好了。</p>
<p>這次我和朋友一共四個人組隊參加比賽，為了增加打題目的效率和互動討論，我們的指導老師陳晉老師將復興高中的圖書館開放給我們以及他的其他學生打題目，並透過安排了兩天一夜的時間讓我們專注比賽（雖然我中途跑去比學科能力競賽所以沒有住宿啦）。</p>
<p>這次的陣容有一些新手，經過競賽後發現每個人都各有所長、各司其職，以下以 A、B、C、D 代稱四位組員，A 和 B 因為有較多的經驗，所以負責專注的打比賽；而 C 相對缺乏經驗，因此 D 在旁邊拉著他，避免拖到團隊後腿（誤）；同時 C 也被賦予了一個相當重要的角色 — — 負責大家的伙食，一到飯點就會聽到 C 開始揪大家叫外送、飲料、豆花。就在我們四位組員巧妙的完美配合下，最終打穿 3 題以 200 分的成績，拿到 27/122 的名次（雖然沒有到很好啦哈哈）。</p>
<p><img src="/posts/2024-CGGC-writeup/01.webp" alt="計分板截圖"></p>
<hr>
<h2 id="Writeup"><a href="#Writeup" class="headerlink" title="Writeup"></a>Writeup</h2><h3 id="Web-previewsite"><a href="#Web-previewsite" class="headerlink" title="Web: previewsite"></a>Web: previewsite</h3><p>網頁是一個提供註冊和登入的頁面，登入後可透過線上工具發送請求到使用者輸入的網址，並顯示回應內容。<br>題目敘述說明 Flag 位於檔案路徑 <code>/flag</code> 中，但在 source code 中請求的網址有進行阻擋，請求的開頭必須為字串 <code>http://previewsite/</code> 。</p>
<p><img src="/posts/2024-CGGC-writeup/02.webp"></p>
<p>經過觀察發現第 14 行的 <code>urlopen</code>，不僅可以對網址發送請求，還可以開啟檔案。同時為了繞過請求網址開頭的限制，最後透過參數 <code>?next</code> 獲取開啟檔案。最後使用 Payload：<code>http://previewsite/logout?next=file:///flag</code> 順利獲得 Flag。</p>
<h3 id="Web-proxy"><a href="#Web-proxy" class="headerlink" title="Web: proxy"></a>Web: proxy</h3><p>題目開啟後顯示原始碼：</p>
<pre><code class="hljs plaintext">&lt;?php

function proxy($service) {
    // $service = "switchrange";
    // $service = "previewsite";
    // $service = "越獄";
    $requestUri = $_SERVER['REQUEST_URI'];
    $parsedUrl = parse_url($requestUri);

    $port = 80;
    if (isset($_GET['port'])) {
        $port = (int)$_GET['port'];
    } else if ($_COOKIE["port"]) {
        $port = (int)$_COOKIE['port'];
    }
    setcookie("service", $service);
    setcookie("port", $port);
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    $filter = '!$%^&amp;*()=+[]{}|;\'",&lt;&gt;?_-/#:.\\@';
    $fixeddomain = trim(trim($service, $filter).".cggc.chummy.tw:".$port, $filter);
    $fixeddomain = idn_to_ascii($fixeddomain);
    $fixeddomain = preg_replace('/[^0-9a-zA-Z-.:_]/', '', $fixeddomain);
    curl_setopt($ch, CURLOPT_URL, 'http://'.$fixeddomain.$parsedUrl['path'].'?'.$_SERVER['QUERY_STRING']);
    curl_exec($ch);
    curl_close($ch);
}

if (!isset($_GET['service']) &amp;&amp; !isset($_COOKIE["service"])) {
    highlight_file(__FILE__);
} else if (isset($_GET['service'])) {
    proxy($_GET['service']);
} else {
    proxy($_COOKIE["service"]);
}</code></pre>

<p>題目要求要請求到一個網址，但我忘記是哪裡了，總之就是一個網址，但此題程式碼強制其鎖定在 <code>.cggc.chummy.tw</code> 內，因此要想辦法繞過。一開始還想在後面加上一些東西繞過去請求，參考這篇，後來發現一直不可行，最後發現可以從 <code>idn_to_ascii</code> 下手。只要輸入很長的字串，<code>idn_to_ascii</code> 就無法解析，然後就會回傳 <code>null</code>，所以最後將 <code>service</code> 設為一個很長的字串就成功繞過了，比賽結束後老師說輸入一個 Unicode 也能使其無法解析。</p>
<h3 id="Misc-Day31-水落石出！真相大白的十一月預告信？"><a href="#Misc-Day31-水落石出！真相大白的十一月預告信？" class="headerlink" title="Misc: Day31- 水落石出！真相大白的十一月預告信？"></a>Misc: Day31- 水落石出！真相大白的十一月預告信？</h3><p>這題給了一個鐵人賽文章連結：<a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/users/20168875/ironman/7849">https://ithelp.ithome.com.tw/users/20168875/ironman/7849</a>，使用 Ticket 詢問此題的小小提示得到是 Information Leak 但我翻遍了 30 天的文章都沒找到 Flag，最後發現在第 19 天的地方 Token 洩漏，使用：<code>curl -s -X POST &lt;https://api.telegram.org/bot&gt;&lt;YOUR_BOT_TOKEN&gt;/getUpdates</code> 就找到 Flag 了。</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2024/11/30/2024-csc-writeup/" title="2024 金盾獎國高中組心得"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: 2024 金盾獎國高中組心得</span></a><a class="button is-default" href="/2024/09/17/2024-SLM-tunning/" title="微調小型語言模型（SLM）製作輔導諮商語音聊天機器人"><span class="has-text-weight-semibold">Next: 微調小型語言模型（SLM）製作輔導諮商語音聊天機器人</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="1PingSun/1PingSun.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/1PingSun"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--><!-- Telegram--><a title="telegram" target="_blank" rel="noopener nofollow" href="//t.me/sunyiping"><i class="fab fa-telegram-plane"></i></a><!-- Signal--></section><p><span>Copyright ©</span><span> 1Ping 2025</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>